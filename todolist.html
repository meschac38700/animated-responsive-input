<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <form action="" id="form">
    <input type="text" id="input">
    <button class="btn">add todo</button>
  </form>
  <div id="todoList"></div>
  <script>

    // TODO: privilégie le selecteur par ID si c'est un seul élément
    const form = document.getElementById("form") 
    const input = document.getElementById("input")
    const divTodo = document.getElementById("todoList")

    /**
    * save given todo in the localStorage
    * @param {string} todo
    */
    function save(todo){
      const todoList = JSON.parse(localStorage.getItem("todoList") ?? "[]")
      if(!todoList.includes(todo)){
        todoList.push(todo)
        localStorage.setItem("todoList", JSON.stringify(todoList))
      }
    }

    /**
    * add todo and save it in the localStorage
    * @param {Event} event 
    * @param {HTMLInputElement} input
    * @param {HTMLElement} parentElement
    */
    function add(event, input, parentElement) {
      if(event)
        event.preventDefault()
      
      let inputValue = input.value

      save(inputValue)
      
      const paragraph = document.createElement("p")
      paragraph.innerText = inputValue // innerText c'est mieux car todo est un texte
      paragraph.setAttribute("class", "todo")
      parentElement.appendChild(paragraph)

    }

    /**
    * Show all tasks in localStorage
    * @param {HTMLElement} parentElement
    */
    function showTodoList(parentElement) {
      const todoList = JSON.parse(localStorage.getItem("todoList") ?? "[]")
      parentElement.innerHTML = todoList.map(todo => `<p class="todo">${todo}</p>`).join("")
    }

    form.addEventListener("submit", (e) => add(e, input, divTodo))

    showTodoList(divTodo)

  </script>
</body>
</html>